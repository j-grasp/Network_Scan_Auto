# /usr/local/etc/nginx/nginx.conf
# FreeBSD nginx config — no sites-available/sites-enabled pattern.
# Single unified config file as is standard on FreeBSD.
# Air-gapped internal vulnerability report portal.

worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    # Disable version disclosure
    server_tokens off;

    server {
        listen       8080;
        server_name  _;

        root  /scans;
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;

        # HTTP Basic Auth
        auth_basic           "Vulnerability Reports — Authorized Personnel Only";
        auth_basic_user_file /usr/local/etc/nginx/.htpasswd;

        # Only serve HTML, JSON, and logs
        location ~* \.(html|json|log)$ {
            add_header X-Content-Type-Options nosniff;
            add_header Cache-Control "no-store, no-cache";
        }

        # Block all other file types
        location ~ \. {
            deny all;
        }

        access_log  /var/log/nginx/vulnscan_access.log;
        error_log   /var/log/nginx/vulnscan_error.log;
    }
}
