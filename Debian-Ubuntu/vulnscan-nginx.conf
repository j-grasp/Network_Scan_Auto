# Air-gapped internal report server
# Serves /scans over LAN with HTTP Basic Auth
# Place this file at: /etc/nginx/sites-available/vulnscan
# Then: ln -s /etc/nginx/sites-available/vulnscan /etc/nginx/sites-enabled/vulnscan

server {
    listen 8080;
    server_name _;

    root /scans;
    autoindex on;
    autoindex_exact_size off;
    autoindex_localtime on;

    # HTTP Basic Auth — restricts report access to authorised personnel
    auth_basic           "Vulnerability Reports — Authorized Personnel Only";
    auth_basic_user_file /etc/nginx/.htpasswd;

    # Only serve HTML, JSON, and logs
    location ~* \.(html|json|log)$ {
        add_header X-Content-Type-Options nosniff;
        add_header Cache-Control "no-store, no-cache";
    }

    # Block all other file types
    location ~ \. {
        deny all;
    }

    access_log /var/log/nginx/vulnscan_access.log;
    error_log  /var/log/nginx/vulnscan_error.log;
}
